<div class="manage-parcels-container">
  <div class="parcels-table-card improved">
    <div class="parcels-table-header">
      <input class="parcels-search" type="text" placeholder="Search by ID, Sender, or Receiver..." [(ngModel)]="search" />
      <select class="parcels-filter" [(ngModel)]="selectedStatus">
        <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
      </select>
      <select class="parcels-filter" [(ngModel)]="selectedZone">
        <option *ngFor="let zone of zones" [value]="zone">{{ zone }}</option>
      </select>
      <button class="clear-filters-btn" (click)="clearFilters()"><i class="fa-solid fa-xmark"></i> Clear Filters</button>
    </div>
    <div class="parcels-table-wrapper">
      <table class="parcels-table improved">
        <thead>
          <tr>
            <th>Parcel ID</th>
            <th>Sender Name</th>
            <th>Receiver Name</th>
            <th>Status</th>
            <th>Last Update</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let parcel of paginatedParcels">
            <td>{{ parcel.id }}</td>
            <td>{{ parcel.sender }}</td>
            <td>{{ parcel.receiver }}</td>
            <td>
              <div class="status-pill">
                <span class="status-badge" [ngClass]="getStatusClass(parcel.status)">
                  <i class="fa-solid" [ngClass]="{
                    'fa-truck-fast': parcel.status === 'In Transit',
                    'fa-circle-check': parcel.status === 'Delivered',
                    'fa-clock': parcel.status === 'Pending',
                    'fa-pause': parcel.status === 'On Hold',
                    'fa-xmark': parcel.status === 'Cancelled'
                  }"></i> {{ parcel.status }}
                </span>
                <select class="status-dropdown improved" [ngModel]="parcel.status" (ngModelChange)="setStatus(parcel, $event)">
                  <option value="In Transit">In Transit</option>
                  <option value="Delivered">Delivered</option>
                  <option value="Pending">Pending</option>
                  <option value="On Hold">On Hold</option>
                  <option value="Cancelled">Cancelled</option>
                </select>
              </div>
            </td>
            <td>{{ parcel.lastUpdate }}</td>
            <td>
              <button class="action-icon" (click)="viewParcel(parcel)"><i class="fa-solid fa-eye"></i></button>
              <button class="action-icon"><i class="fa-solid fa-pen"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="parcels-pagination">
      <span>Show {{ (page - 1) * pageSize + 1 }} to {{ min(page * pageSize, filteredParcels.length) }} of {{ filteredParcels.length }} results</span>
      <div class="pagination-controls">
        <button (click)="page = max(1, page - 1)" [disabled]="page === 1">&lt; Previous</button>
        <span *ngFor="let p of [].constructor(totalPages); let i = index">
          <button [class.active]="page === i + 1" (click)="page = i + 1">{{ i + 1 }}</button>
        </span>
        <button (click)="page = min(totalPages, page + 1)" [disabled]="page === totalPages">Next &gt;</button>
      </div>
    </div>
  </div>
</div>
