<div class="profile-page-container">
  <h1 class="profile-title">Manage Your Profile</h1>
  <div class="profile-main-grid">
    <!-- Left: User Info and Recent Shipments -->
    <div class="profile-main-left">
      <div class="profile-card">
        <ng-container *ngIf="!editMode(); else editProfileForm">
          <div class="profile-photo-section">
            <img *ngIf="user().photo; else placeholder" [src]="user().photo" class="profile-photo" alt="Profile photo" />
            <ng-template #placeholder>
              <div class="profile-photo-placeholder">{{ user().name[0] }}</div>
            </ng-template>
            <span class="camera-icon" (click)="openEditProfile()"><i class="fa-solid fa-camera"></i></span>
          </div>
          <div class="profile-name">{{ user().name }}</div>
          <a href="#" class="profile-edit-link" (click)="$event.preventDefault(); openEditProfile()">Edit Account Photo</a>
          <div class="profile-info-grid">
            <div>
              <div class="profile-label">Full Name</div>
              <div class="profile-value">{{ user().name }}</div>
            </div>
            <div>
              <div class="profile-label">Email Address</div>
              <div class="profile-value">{{ user().email }}</div>
            </div>
            <div>
              <div class="profile-label">Phone Number</div>
              <div class="profile-value">{{ user().phone }}</div>
            </div>
          </div>
          <div class="profile-actions">
            <button class="profile-btn profile-btn-outline">Change Password</button>
            <button class="profile-btn profile-btn-orange" (click)="openEditProfile()">Update Details</button>
          </div>
        </ng-container>
        <ng-template #editProfileForm>
          <form (submit)="$event.preventDefault(); saveProfile()">
            <div class="profile-photo-section">
              <img *ngIf="photoPreview(); else editPlaceholder" [src]="photoPreview()" class="profile-photo" alt="Profile photo preview" />
              <ng-template #editPlaceholder>
                <div class="profile-photo-placeholder">{{ editForm().name[0] || 'U' }}</div>
              </ng-template>
              <label class="camera-icon" for="photoInput"><i class="fa-solid fa-camera"></i></label>
              <input id="photoInput" type="file" accept="image/*" style="display:none" (change)="onPhotoSelected($event)" />
            </div>
            <div class="profile-name">
              <input #nameInput class="profile-edit-input" type="text" [value]="editForm().name" (input)="onEditInputChange('name', nameInput.value)" placeholder="Full Name" required />
            </div>
            <div class="profile-info-grid">
              <div>
                <div class="profile-label">Full Name</div>
                <input #nameInput2 class="profile-edit-input" type="text" [value]="editForm().name" (input)="onEditInputChange('name', nameInput2.value)" required />
              </div>
              <div>
                <div class="profile-label">Email Address</div>
                <input #emailInput class="profile-edit-input" type="email" [value]="editForm().email" (input)="onEditInputChange('email', emailInput.value)" required />
              </div>
              <div>
                <div class="profile-label">Phone Number</div>
                <input #phoneInput class="profile-edit-input" type="tel" [value]="editForm().phone" (input)="onEditInputChange('phone', phoneInput.value)" required />
              </div>
            </div>
            <div class="profile-actions">
              <button type="button" class="profile-btn profile-btn-outline" (click)="closeEditProfile()">Cancel</button>
              <button type="submit" class="profile-btn profile-btn-orange">Save</button>
            </div>
          </form>
        </ng-template>
      </div>
      <div class="profile-card profile-shipments">
        <div class="profile-card-title-row">
          <div class="profile-card-title">Recent Shipments</div>
          <button class="profile-card-link" (click)="toggleShipmentsView()">
            {{ showAllShipments() ? 'Show Less' : 'View All' }}
          </button>
        </div>
        <div class="profile-shipments-list">
          <div *ngFor="let s of getDisplayedShipments()" class="shipment-row">
            <div class="shipment-icon"><i class="fa-solid fa-truck"></i></div>
            <div class="shipment-info">
              <div class="shipment-title">{{ s.title }}</div>
              <div class="shipment-meta">Tracking ID: {{ s.trackingId }}</div>
            </div>
            <div class="shipment-status" [ngClass]="s.status.toLowerCase().replace(' ', '-')">{{ s.status }}</div>
            <div class="shipment-date">{{ s.date }}</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Right: Profile Completeness, Payment, Notifications -->
    <div class="profile-main-right">
      <div class="profile-card profile-completeness">
        <div class="profile-label">Profile Completeness</div>
        <div class="profile-progress-bar">
          <div class="profile-progress" [style.width]="user().profileComplete + '%'" ></div>
        </div>
        <div class="profile-progress-text">Your profile is {{ user().profileComplete }}% complete. Add more details to enhance your experience.</div>
        <button class="profile-btn profile-btn-orange w-full">Complete Profile</button>
      </div>
      <div class="profile-card profile-payments">
        <div class="profile-card-title-row">
          <div class="profile-card-title">Payment Methods</div>
          <button class="profile-card-link" (click)="openAddPayment()">Add New</button>
        </div>
        <ng-container *ngIf="!paymentEditMode(); else addPaymentForm">
          <div class="profile-payments-list">
            <div *ngFor="let p of paymentMethods()" class="payment-row">
              <div class="payment-type" [ngClass]="p.type.toLowerCase()">{{ p.type }}</div>
              <div class="payment-last4">**** {{ p.last4 }}</div>
              <div class="payment-expires">Expires {{ p.expires }}</div>
              <button class="payment-remove" (click)="removePaymentMethod(p.id)">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
          </div>
        </ng-container>
        <ng-template #addPaymentForm>
          <form (submit)="$event.preventDefault(); addPaymentMethod()" class="payment-form">
            <div class="payment-form-row">
              <label class="payment-form-label">Card Type</label>
              <select #typeSelect class="payment-form-input" [value]="newPaymentForm().type" (change)="onPaymentInputChange('type', typeSelect.value)">
                <option value="Visa">Visa</option>
                <option value="Mastercard">Mastercard</option>
                <option value="Bank">Bank Account</option>
              </select>
            </div>
            <div class="payment-form-row">
              <label class="payment-form-label">Card Number</label>
              <input #cardNumber class="payment-form-input" type="text" [value]="newPaymentForm().number" (input)="onPaymentInputChange('number', cardNumber.value)" placeholder="1234 5678 9012 3456" required />
            </div>
            <div class="payment-form-row payment-form-row-2">
              <div>
                <label class="payment-form-label">Expires</label>
                <input #expires class="payment-form-input" type="text" [value]="newPaymentForm().expires" (input)="onPaymentInputChange('expires', expires.value)" placeholder="MM/YY" required />
              </div>
              <div>
                <label class="payment-form-label">CVV</label>
                <input #cvv class="payment-form-input" type="text" [value]="newPaymentForm().cvv" (input)="onPaymentInputChange('cvv', cvv.value)" placeholder="123" required />
              </div>
            </div>
            <div class="payment-form-actions">
              <button type="button" class="profile-btn profile-btn-outline" (click)="closeAddPayment()">Cancel</button>
              <button type="submit" class="profile-btn profile-btn-orange">Add Payment</button>
            </div>
          </form>
        </ng-template>
      </div>
      <div class="profile-card profile-notifications">
        <div class="profile-card-title">Notification Preferences</div>
        <div class="notification-row">
          <span>SMS Notifications</span>
          <label class="switch">
            <input type="checkbox" [checked]="notifications().sms" (change)="toggleNotification('sms')" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="notification-row">
          <span>Email Notifications</span>
          <label class="switch">
            <input type="checkbox" [checked]="notifications().email" (change)="toggleNotification('email')" />
            <span class="slider"></span>
          </label>
        </div>
        <a href="#" class="profile-card-link">Manage All Preferences</a>
      </div>
    </div>
  </div>
</div> 